(function(){"use strict";class U{constructor(l={}){this.radianceChances=l.radianceChances||[0,.25,.5,1],this.sampleSize=l.sampleSize||500}simulate(l,m=null){const o=new Float64Array(90);for(let e=0;e<90;e++){const t=e+1;t>=90?o[e]=1:t<=73?o[e]=.006:o[e]=Math.min(.006+(t-73)*.06,1)}let d=0,n=0,c=0,w=0,h=0,S=0,y=0,z=0;const A=[0,0,0,0],b=new Uint32Array(90),P=[0,0];let D=0,V=0;const B=this.sampleSize,a=[];let M=0,g=0,F=!1,u=0;const q=1e5;let L=0;const x=this.radianceChances;for(let e=0;e<l;e++){let t=0,f=0,p=!1;for(;!p;)if(d++,t++,f++,Math.random()<o[t-1]){n++,b[t-1]++,D+=t,M+=t,g++,g>=B&&(a.push(M/g),M=0,g=0);let r=!1;if(F)P[1]++,z++,F=!1,r=!0;else if(P[0]++,Math.random()<.5)h++,u=0,r=!0;else{const T=x[Math.min(u,3)];Math.random()<T?(y++,A[u]++,u=0,r=!0):(S++,u=Math.min(u+1,3),F=!0,r=!1)}r?(c++,V+=f,p=!0,f=0):w++,t=0}if(m&&e%q===0){const r=Math.round(e/l*100);r>L&&(m(r),L=r)}}a.sort((e,t)=>e-t);const k=[];for(let e=30;e<=90;e++){let t=0;for(let p=0;p<a.length&&a[p]<=e;p++)t++;const f=a.length>0?t/a.length*100:50;k.push({avgPity:e,percentile:f})}const i=a.length;let v=0,R=0;i>0&&(v=a.reduce((e,t)=>e+t,0)/i,R=a.reduce((e,t)=>e+Math.pow(t-v,2),0)/i);const H=Math.sqrt(R),s=e=>{if(i===0)return 62.5;const t=Math.floor(e/100*i);return a[Math.min(t,i-1)]};return{totalPulls:d,total5Star:n,featured5Star:c,standard5Star:w,rate5Star:n/d,rateFeatured:c/n,avg5StarPity:D/n,avgPullsPerFeatured:V/c,wonFiftyFifty:h,lostFiftyFifty:S,guaranteeUsed:z,fiftyFiftyWinRate:h/(h+S),radianceSaved:y,radianceByCounter:Array.from(A),radianceRate:y/(y+S),pityDistribution:Array.from(b),guaranteeStateVisits:Array.from(P),sampleStats:{sampleSize:B,sampleCount:i,sampleMean:v,sampleStdDev:H,percentiles:{p1:s(1),p5:s(5),p10:s(10),p25:s(25),p50:s(50),p75:s(75),p90:s(90),p95:s(95),p99:s(99)},avgPityPercentileLookup:k}}}}self.onmessage=function(C){const{numSimulations:l,radianceChances:m,sampleSize:o}=C.data,n=new U({radianceChances:m,sampleSize:o||500}).simulate(l,c=>{self.postMessage({type:"progress",progress:c})});self.postMessage({type:"complete",results:n})}})();
